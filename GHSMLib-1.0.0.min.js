/**
 * version:1.0.0.201601201229
 * Created by jianyingshuo on 2015/12/08.
 */
"use strict";!function(t,n){function e(t,n){return"object"==typeof t?(this.mList=t,"number"!=typeof n||0>n||n>2?this.type=1:this.type=n,this.len=this.mList.length,this.currentIndex=-1,this.audio=null,this.init(),this):void 0}function i(){this.index={},this.size={}}function o(){this.wsUrl="",this.subscribe="",this.actions={},this.client=null}function c(){this._WS=new o,this._initScript()}var u=null,s="http://172.16.188.26/web/GHSMLib",r=function(){var e={};return e.getTime=Date.now||(new Date).getTime(),e.extend=function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])},e.loadScript=function(t,e){var i=n.getElementsByTagName("head")[0];if(i){var o=n.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.onload=e,i.appendChild(o)}},e.qrCode=function(t,n){return"http://172.16.188.13/api/common/Image/qrCode.png?text="+t+"&size="+n},e.getQueryString=function(n){var e=RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),i=t.location.search.substr(1).match(e);return null!=i?i[2]:null},e}();e.prototype={init:function(){var t=this,e=n.createElement("audio"),i=n.getElementsByTagName("body")[0];e.style.display="none",i.appendChild(e),this.audio=e,t.play(),e.onended=function(){t.next()}},next:function(){var t=this.type,n=this.currentIndex;if(0==t)-1==n&&(n=0);else if(1==t)-1==n?n=0:n==this.len-1?n=0:n++;else if(2==t&&(n=parseInt(this.len*Math.random()),this.len>1&&n==this.currentIndex||n>this.len-1||0>n))return void this.next();this.playByIdx(n)},pre:function(){},pause:function(){this.audio.pause()},play:function(){-1==this.currentIndex?this.next():this.audio.play()},playByIdx:function(t){this.audio.src=this.mList[t],this.audio.play(),this.currentIndex=t},addMusic:function(t){this.mList.push(t),this.len=this.mList.length},setMusic:function(t){this.mList=t,this.len=this.mList.length},setType:function(t){"number"==typeof t&&t>=0&&3>t&&(this.type=t,console.log(this.type))}},i.prototype={_executeFun:function(t,n){var e=["before","center","after"],i=!0;if("function"==typeof t)i=t(n),void 0===i&&(i=!0);else if("object"==typeof t)for(var o in e)"function"==typeof t[e[o]]&&i&&(i=t[e[o]](n),void 0===i&&(i=!0));return i},keyListener:function(t){var e=this,i=t.id,o=u("#"+i),c=o;n.getElementById(i).onkeydown=function(n){var i=n.target;switch(n&&n.keyCode){case 8:return e._executeFun(t.back,i);case 13:return e._executeFun(t.enter,i);case 27:return e._executeFun(t.esc,i);case 33:return e._executeFun(t.pageUp,i);case 34:return e._executeFun(t.pageDown,i);case 37:return e._executeFun(t.left,i);case 38:return e._executeFun(t.up,i);case 39:return e._executeFun(t.right,i);case 40:return e._executeFun(t.down,i)}},t.label&&(c=o.find(t.label)),c.focus(function(){"function"==typeof t.focus&&t.focus(this)}),c.blur(function(){"function"==typeof t.blur&&t.blur(this)}),c.click(function(){var n=!0;"function"==typeof t.click&&(n=t.click(this),void 0===n&&(n=!0)),"function"==typeof t.enter&&n&&(u(this).attr("tabindex","-1").focus(),t.enter(this))})},listKeyListener:function(t){var n=this,e=t.id,i=u("#"+e).find(t.label),o=i.length;if(n.index[e]=0,n.size[e]=o,"function"!=typeof t.left&&("object"!=typeof t.left?t.left=function(t){var n=u(t).index();u(i[--n]).attr("tabindex",-1).focus()}:"function"!=typeof t.left.center&&(t.left.center=function(t){var n=u(t).index();u(i[--n]).attr("tabindex",-1).focus()})),"function"!=typeof t.up&&("object"!=typeof t.up?t.up=function(n){var e=u(n).index();e>t.columnNum-1&&(e-=t.columnNum,u(i[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.up.center&&(t.up.center=function(n){var e=u(n).index();e>t.columnNum-1&&(e-=t.columnNum,u(i[e]).attr("tabindex",-1).focus())})),"function"!=typeof t.right&&("object"!=typeof t.right?t.right=function(t){var n=u(t).index();o-1>n&&u(i[++n]).attr("tabindex",-1).focus()}:"function"!=typeof t.right.center&&(t.right.center=function(t){var n=u(t).index();o-1>n&&u(i[++n]).attr("tabindex",-1).focus()})),"function"!=typeof t.down&&("object"!=typeof t.down?t.down=function(n){var e=u(n).index();e<o-t.columnNum&&(e+=t.columnNum,u(i[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.down.center&&(t.down.center=function(n){var e=u(n).index();e<o-t.columnNum&&(e+=t.columnNum,u(i[e]).attr("tabindex",-1).focus())})),"function"==typeof t.focus){var c=t.focus;t.focus=function(t){n.index[e]=u(t).index(),c(t)}}else t.focus=function(t){n.index[e]=u(t).index()};n.keyListener(t)}},o.prototype={_init:function(t){this.tvCode=t,this._verifyWS()},connect:function(){var n=this,e=new SockJS(this.wsUrl+this.tvCode);this.client=Stomp.over(e),this.client.debug=function(t){},this.client.connect({},function(){n._subscribe()},this.onClose(n)),t.onbeforeunload=function(){n.disconnect()}},disconnect:function(){this.client.disconnect(),this.client=null},_verifyWS:function(){var t=this,n=u("#GHSMLib").attr("key");n&&u.getJSON(s+"/json/"+n+".json",function(n){t.wsUrl=n.ws,t.subscribe=n.subscribe,""!=this.wsUrl?t.connect():console.error("\u9519\u8bef\u7684ws")})},_subscribe:function(){var t=this;this.client.subscribe(t.subscribe,function(n){var e=JSON.parse(n.body),i=e.action,o=e.props;t.actions[i]&&"function"==typeof t.actions[i]&&t.actions[i](o,e.openId)})},onClose:function(t){return function(){setTimeout(function(){t.connect()},1e3)}},addActions:function(t){return"object"==typeof t?(r.extend(this.actions,t),!0):!1}},c.prototype={version:"1.0.0",tvCode:"",_init:function(){"undefined"!=typeof CyberCloud&&(this.tvCode=CyberCloud.GetParam("CardID").ParamValue,this._WS._init(this.tvCode))},_initScript:function(){var n=0,e=2,i=5e3,o=s+"/lib/",c=this,f=function(){n++,n==e&&c._init()};!t.jQuery||t.jQuery&&t.jQuery().jquery.substring(0,3)<1.9?(e++,r.loadScript(o+"jquery-2.1.3.min.js",function(){u=jQuery.noConflict(!0),f()})):u=t.jQuery,r.loadScript(o+"sockjs-1.0.0.min.js",f),r.loadScript(o+"stomp.min.js",f),setTimeout(function(){n!=e&&console.error("js\u6587\u4ef6\u52a0\u8f7d\u8d85\u65f6")},i)},addActions:function(t){var n=!1;return"object"==typeof t&&this._WS&&(n=this._WS.addActions(t)),n}},t.GHSMLib=new c,t.GHSMLib.utils=r,t.GHSMLib.keyCon=new i,t.GHSMLib.AudioPlayer=e}(window,document);