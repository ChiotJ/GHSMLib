/**
 * version:1.0.0.2313
 * Created by jianyingshuo on 2015/12/27.
 */
"use strict";!function(t,n){function i(){this.wsUrl="",this.actions={},this.client=null}function e(){this._WS=new i,this._initScript()}var o=null,s="http://172.16.200.74/web/GHSMLib",c=function(){var t={};return t.getTime=Date.now||(new Date).getTime(),t.extend=function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},t.loadScript=function(t,i){var e=n.getElementsByTagName("head")[0];if(e){var o=n.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.onload=i,e.appendChild(o)}},t.qrCode=function(t,n){return"http://172.16.188.13/api/common/Image/qrCode.png?text="+t+"&size="+n},t}();i.prototype={_init:function(t){this.tvCode=t,this._verifyWS()},connect:function(){var n=this,i=new SockJS(this.wsUrl+this.tvCode);this.client=Stomp.over(i),this.client.debug=function(t){},this.client.connect({},function(){n._subscribe()},this.onClose),t.onbeforeunload=function(){n.disconnect()}},disconnect:function(){this.client.disconnect(),this.client=null},_verifyWS:function(){var t=this,n=o("#GHSMLib").attr("key");o.getJSON(s+"/json/"+n+".json",function(n){t.wsUrl=n.ws,""!=this.wsUrl?t.connect():console.error("\u9519\u8bef\u7684ws")})},_subscribe:function(){var t=this;this.client.subscribe("/user/actions",function(n){var i=JSON.parse(n.body),e=i.action,o=i.props;t.actions[e]&&"function"==typeof t.actions[e]&&t.actions[e](o,i.openId)})},onClose:function(){},addActions:function(t){return"object"==typeof t?(c.extend(this.actions,t),!0):!1}},e.prototype={version:"1.0.0",tvCode:"",_init:function(){"undefined"!=typeof CyberCloud&&(this.tvCode=CyberCloud.GetParam("CardID").ParamValue,this._WS._init(this.tvCode))},_initScript:function(){var n=0,i=2,e=5e3,r=s+"/lib/",u=this,a=function(){n++,n==i&&u._init()};!t.jQuery||t.jQuery&&t.jQuery().jquery.substring(0,3)<1.9?(i++,c.loadScript(r+"jquery-2.1.3.min.js",function(){o=jQuery.noConflict(!0),a()})):o=t.jQuery,c.loadScript(r+"sockjs-1.0.0.min.js",a),c.loadScript(r+"stomp.min.js",a),setTimeout(function(){n!=i&&console.error("js\u6587\u4ef6\u52a0\u8f7d\u8d85\u65f6")},e)},addActions:function(t){var n=!1;return"object"==typeof t&&this._WS&&(n=this._WS.addActions(t)),n}},t.GHSMLib=new e,t.GHSMLib.utils=c}(window,document);