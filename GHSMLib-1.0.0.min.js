/**
 * version:1.0.0.201601211613
 * Created by jianyingshuo on 2015/12/08.
 */
"use strict";!function(t,e){function n(t,e){return"object"==typeof t?(this.mList=t,"number"!=typeof e||0>e||e>2?this.type=1:this.type=e,this.len=this.mList.length,this.currentIndex=-1,this.audio=null,this.init(),this):void 0}function i(){this.index={},this.size={}}function o(){this.wsUrl="",this.subscribe="",this.actions={},this.client=null}function u(){this._WS=new o,this._initScript()}var c=null,s="http://172.16.188.26/web/GHSMLib",r=function(){var n={};return n.getTime=Date.now||(new Date).getTime(),n.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},n.loadScript=function(t,n){var i=e.getElementsByTagName("head")[0];if(i){var o=e.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.onload=n,i.appendChild(o)}},n.qrCode=function(t,e){return"http://172.16.188.13/api/common/Image/qrCode.png?text="+t+"&size="+e},n.getQueryString=function(e){var n=RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=t.location.search.substr(1).match(n);return null!=i?i[2]:null},n}();n.prototype={init:function(){var t=this,n=e.createElement("audio"),i=e.getElementsByTagName("body")[0];n.style.display="none",i.appendChild(n),this.audio=n,t.play(),n.onended=function(){t.next()}},next:function(){var t=this.type,e=this.currentIndex;if(0==t)-1==e&&(e=0);else if(1==t)-1==e?e=0:e==this.len-1?e=0:e++;else if(2==t&&(e=parseInt(this.len*Math.random()),this.len>1&&e==this.currentIndex||e>this.len-1||0>e))return void this.next();this.playByIdx(e)},pre:function(){},pause:function(){this.audio.pause()},play:function(){-1==this.currentIndex?this.next():this.audio.play()},playByIdx:function(t){this.audio.src=this.mList[t],this.audio.play(),this.currentIndex=t},addMusic:function(t){this.mList.push(t),this.len=this.mList.length},setMusic:function(t){this.mList=t,this.len=this.mList.length},setType:function(t){"number"==typeof t&&t>=0&&3>t&&(this.type=t,console.log(this.type))}},i.prototype={_executeFun:function(t,e){var n=["before","center","after"],i=!0;if("function"==typeof t)i=t(e),void 0===i&&(i=!0);else if("object"==typeof t)for(var o in n)"function"==typeof t[n[o]]&&i&&(i=t[n[o]](e),void 0===i&&(i=!0));return i},keyListener:function(t){var n=this,i=t.id,o=c("#"+i),u=o;e.getElementById(i).onkeydown=function(e){var i=e.target;switch(e&&e.keyCode){case 8:return n._executeFun(t.back,i);case 13:return n._executeFun(t.enter,i);case 27:return n._executeFun(t.esc,i);case 33:return n._executeFun(t.pageUp,i);case 34:return n._executeFun(t.pageDown,i);case 37:return n._executeFun(t.left,i);case 38:return n._executeFun(t.up,i);case 39:return n._executeFun(t.right,i);case 40:return n._executeFun(t.down,i);case 48:return n._executeFun(t.n0,i);case 49:return n._executeFun(t.n1,i);case 50:return n._executeFun(t.n2,i);case 51:return n._executeFun(t.n3,i);case 52:return n._executeFun(t.n4,i);case 53:return n._executeFun(t.n5,i);case 54:return n._executeFun(t.n6,i);case 55:return n._executeFun(t.n7,i);case 56:return n._executeFun(t.n8,i);case 57:return n._executeFun(t.n9,i)}},t.label&&(u=o.find(t.label)),u.focus(function(){"function"==typeof t.focus&&t.focus(this)}),u.blur(function(){"function"==typeof t.blur&&t.blur(this)}),u.click(function(){var e=!0;"function"==typeof t.click&&(e=t.click(this),void 0===e&&(e=!0)),"function"==typeof t.enter&&e&&(c(this).attr("tabindex","-1").focus(),t.enter(this))})},listKeyListener:function(t){var e=this,n=t.id,i=c("#"+n).find(t.label),o=i.length;if(e.index[n]=0,e.size[n]=o,"function"!=typeof t.left&&("object"!=typeof t.left?t.left=function(t){var e=c(t).index();c(i[--e]).attr("tabindex",-1).focus()}:"function"!=typeof t.left.center&&(t.left.center=function(t){var e=c(t).index();c(i[--e]).attr("tabindex",-1).focus()})),"function"!=typeof t.up&&("object"!=typeof t.up?t.up=function(e){var n=c(e).index();n>t.columnNum-1&&(n-=t.columnNum,c(i[n]).attr("tabindex",-1).focus())}:"function"!=typeof t.up.center&&(t.up.center=function(e){var n=c(e).index();n>t.columnNum-1&&(n-=t.columnNum,c(i[n]).attr("tabindex",-1).focus())})),"function"!=typeof t.right&&("object"!=typeof t.right?t.right=function(t){var e=c(t).index();o-1>e&&c(i[++e]).attr("tabindex",-1).focus()}:"function"!=typeof t.right.center&&(t.right.center=function(t){var e=c(t).index();o-1>e&&c(i[++e]).attr("tabindex",-1).focus()})),"function"!=typeof t.down&&("object"!=typeof t.down?t.down=function(e){var n=c(e).index();n<o-t.columnNum&&(n+=t.columnNum,c(i[n]).attr("tabindex",-1).focus())}:"function"!=typeof t.down.center&&(t.down.center=function(e){var n=c(e).index();n<o-t.columnNum&&(n+=t.columnNum,c(i[n]).attr("tabindex",-1).focus())})),"function"==typeof t.focus){var u=t.focus;t.focus=function(t){e.index[n]=c(t).index(),u(t)}}else t.focus=function(t){e.index[n]=c(t).index()};e.keyListener(t)}},o.prototype={_init:function(t){this.tvCode=t,this._verifyWS()},connect:function(){var e=this,n=new SockJS(this.wsUrl+this.tvCode);this.client=Stomp.over(n),this.client.debug=function(t){},this.client.connect({},function(){e._subscribe()},this.onClose(e)),t.onbeforeunload=function(){e.disconnect()}},disconnect:function(){this.client.disconnect(),this.client=null},_verifyWS:function(){var t=this,e=c("#GHSMLib").attr("key");e&&c.getJSON(s+"/json/"+e+".json",function(e){t.wsUrl=e.ws,t.subscribe=e.subscribe,""!=this.wsUrl?t.connect():console.error("\u9519\u8bef\u7684ws")})},_subscribe:function(){var t=this;this.client.subscribe(t.subscribe,function(e){var n=JSON.parse(e.body),i=n.action,o=n.props;t.actions[i]&&"function"==typeof t.actions[i]&&t.actions[i](o,n.openId)})},onClose:function(t){return function(){setTimeout(function(){t.connect()},1e3)}},addActions:function(t){return"object"==typeof t?(r.extend(this.actions,t),!0):!1}},u.prototype={version:"1.0.0",tvCode:"",_init:function(){"undefined"!=typeof CyberCloud&&(this.tvCode=CyberCloud.GetParam("CardID").ParamValue,this._WS._init(this.tvCode))},_initScript:function(){var e=0,n=2,i=5e3,o=s+"/lib/",u=this,f=function(){e++,e==n&&u._init()};!t.jQuery||t.jQuery&&t.jQuery().jquery.substring(0,3)<1.9?(n++,r.loadScript(o+"jquery-2.1.3.min.js",function(){c=jQuery.noConflict(!0),f()})):c=t.jQuery,r.loadScript(o+"sockjs-1.0.0.min.js",f),r.loadScript(o+"stomp.min.js",f),setTimeout(function(){e!=n&&console.error("js\u6587\u4ef6\u52a0\u8f7d\u8d85\u65f6")},i)},addActions:function(t){var e=!1;return"object"==typeof t&&this._WS&&(e=this._WS.addActions(t)),e}},t.GHSMLib=new u,t.GHSMLib.utils=r,t.GHSMLib.keyCon=new i,t.GHSMLib.AudioPlayer=n}(window,document);