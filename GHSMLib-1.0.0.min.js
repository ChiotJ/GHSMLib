/**
 * version:1.0.0.201601190924
 * Created by jianyingshuo on 2015/12/08.
 */
"use strict";!function(t,n){function e(){this.index={},this.size={}}function i(){this.wsUrl="",this.subscribe="",this.actions={},this.client=null}function o(){this._WS=new i,this._initScript()}var c=null,u="http://172.16.188.26/web/GHSMLib",r=function(){var e={};return e.getTime=Date.now||(new Date).getTime(),e.extend=function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])},e.loadScript=function(t,e){var i=n.getElementsByTagName("head")[0];if(i){var o=n.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.onload=e,i.appendChild(o)}},e.qrCode=function(t,n){return"http://172.16.188.13/api/common/Image/qrCode.png?text="+t+"&size="+n},e.getQueryString=function(n){var e=RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),i=t.location.search.substr(1).match(e);return null!=i?i[2]:null},e}();e.prototype={_executeFun:function(t,n){var e=["before","center","after"],i=!0;if("function"==typeof t)i=t(n),void 0===i&&(i=!0);else if("object"==typeof t)for(var o in e)"function"==typeof t[e[o]]&&i&&(i=t[e[o]](n),void 0===i&&(i=!0));return i},keyListener:function(t){var e=this,i=t.id,o=c("#"+i),u=o;n.getElementById(i).onkeydown=function(n){var i=n.target;switch(n&&n.keyCode){case 8:return e._executeFun(t.back,i);case 13:return e._executeFun(t.enter,i);case 27:return e._executeFun(t.esc,i);case 33:return e._executeFun(t.pageUp,i);case 34:return e._executeFun(t.pageDown,i);case 37:return e._executeFun(t.left,i);case 38:return e._executeFun(t.up,i);case 39:return e._executeFun(t.right,i);case 40:return e._executeFun(t.down,i)}},t.label&&(u=o.find(t.label)),u.focus(function(){"function"==typeof t.focus&&t.focus(this)}),u.blur(function(){"function"==typeof t.blur&&t.blur(this)}),u.click(function(){var n=!0;"function"==typeof t.click&&(n=t.click(this),void 0===n&&(n=!0)),"function"==typeof t.enter&&n&&(c(this).attr("tabindex","-1").focus(),t.enter(this))})},listKeyListener:function(t){var n=this,e=t.id,i=c("#"+e).find(t.label),o=i.length;if(n.index[e]=0,n.size[e]=o,"function"!=typeof t.left&&("object"!=typeof t.left?t.left=function(t){var n=c(t).index();c(i[--n]).attr("tabindex",-1).focus()}:"function"!=typeof t.left.center&&(t.left.center=function(t){var n=c(t).index();c(i[--n]).attr("tabindex",-1).focus()})),"function"!=typeof t.up&&("object"!=typeof t.up?t.up=function(n){var e=c(n).index();e>t.columnNum-1&&(e-=t.columnNum,c(i[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.up.center&&(t.up.center=function(n){var e=c(n).index();e>t.columnNum-1&&(e-=t.columnNum,c(i[e]).attr("tabindex",-1).focus())})),"function"!=typeof t.right&&("object"!=typeof t.right?t.right=function(t){var n=c(t).index();o-1>n&&c(i[++n]).attr("tabindex",-1).focus()}:"function"!=typeof t.right.center&&(t.right.center=function(t){var n=c(t).index();o-1>n&&c(i[++n]).attr("tabindex",-1).focus()})),"function"!=typeof t.down&&("object"!=typeof t.down?t.down=function(n){var e=c(n).index();e<o-t.columnNum&&(e+=t.columnNum,c(i[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.down.center&&(t.down.center=function(n){var e=c(n).index();e<o-t.columnNum&&(e+=t.columnNum,c(i[e]).attr("tabindex",-1).focus())})),"function"==typeof t.focus){var u=t.focus;t.focus=function(t){n.index[e]=c(t).index(),u(t)}}else t.focus=function(t){n.index[e]=c(t).index()};n.keyListener(t)}},i.prototype={_init:function(t){this.tvCode=t,this._verifyWS()},connect:function(){var n=this,e=new SockJS(this.wsUrl+this.tvCode);this.client=Stomp.over(e),this.client.debug=function(t){},this.client.connect({},function(){n._subscribe()},this.onClose(n)),t.onbeforeunload=function(){n.disconnect()}},disconnect:function(){this.client.disconnect(),this.client=null},_verifyWS:function(){var t=this,n=c("#GHSMLib").attr("key");n&&c.getJSON(u+"/json/"+n+".json",function(n){t.wsUrl=n.ws,t.subscribe=n.subscribe,""!=this.wsUrl?t.connect():console.error("\u9519\u8bef\u7684ws")})},_subscribe:function(){var t=this;this.client.subscribe(t.subscribe,function(n){var e=JSON.parse(n.body),i=e.action,o=e.props;t.actions[i]&&"function"==typeof t.actions[i]&&t.actions[i](o,e.openId)})},onClose:function(t){return function(){setTimeout(function(){t.connect()},1e3)}},addActions:function(t){return"object"==typeof t?(r.extend(this.actions,t),!0):!1}},o.prototype={version:"1.0.0",tvCode:"",_init:function(){"undefined"!=typeof CyberCloud&&(this.tvCode=CyberCloud.GetParam("CardID").ParamValue,this._WS._init(this.tvCode))},_initScript:function(){var n=0,e=2,i=5e3,o=u+"/lib/",s=this,f=function(){n++,n==e&&s._init()};!t.jQuery||t.jQuery&&t.jQuery().jquery.substring(0,3)<1.9?(e++,r.loadScript(o+"jquery-2.1.3.min.js",function(){c=jQuery.noConflict(!0),f()})):c=t.jQuery,r.loadScript(o+"sockjs-1.0.0.min.js",f),r.loadScript(o+"stomp.min.js",f),setTimeout(function(){n!=e&&console.error("js\u6587\u4ef6\u52a0\u8f7d\u8d85\u65f6")},i)},addActions:function(t){var n=!1;return"object"==typeof t&&this._WS&&(n=this._WS.addActions(t)),n}},t.GHSMLib=new o,t.GHSMLib.utils=r,t.GHSMLib.keyCon=new e}(window,document);