/**
 * Created by jian_ on 2016/2/18.
 */
!function(n,t){"use strict";function e(t){var e,o=n.location.hostname,r=n.location.pathname;c.ajax({url:f+"/json/userBehavior/pvSetting.json",async:!1,success:function(n){var t=n[o];if(t&&t.length>0)for(var a in t){var i=t[a].regular,u=t[a].name;for(var c in i)0==r.indexOf(i[c])&&(e=u)}}}),e&&t&&(this.appName=e,this.cardId=t,this.pv())}function o(n){var t,e=!1,o={cardId:n},r=[],a=function(){c.ajax({url:s[2]+"box/getBoxByCardId",data:{cardId:o.cardId},type:"GET",dataType:"json",success:function(n){n.success?(o.name=n.result.name,o.phone=n.result.phone,o.address=n.result.address,o.location={},o.location.lat=n.result.latitude,o.location.lng=n.result.longitude,"object"==typeof n.result.department&&(o.departmentId=n.result.department.id),d()):(t="\u670d\u52a1\u5668\u9519\u8bef",f())},error:function(n){t="\u670d\u52a1\u5668\u9519\u8bef",f()}})},i=function(n){var t={lat:o.location.lat,lng:o.location.lng},e=n.communitys;for(var r in e){var a=e[r],i=a.poly,u=p(t,i);if(u){var c=o.departmentId;o.departmentId=a.id1,o.community={},o.community.name=a.name,o.community.id1=a.id1||"",o.community.id2=a.id2||"",o.community.id3=a.id3||"",(void 0===c||c!=o.departmentId)&&l();break}}void 0===o.community&&(o.community="\u6b64\u5730\u5740\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u793e\u533a"),f()},u=function(n){var t={lat:o.location.lat,lng:o.location.lng},e=!1;for(var r in n){var a=n[r],u=a.poly;if(e=p(t,u)){c.getJSON(s[0]+s[4].replace("$street",a.file),function(n){i(n)}),o.street=a.id,o.streetName=a.name;break}}e||(o.community="\u6b64\u5730\u5740\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u793e\u533a",f())},f=function(){if(e=!0,r.length>0)for(var n in r)r[n](o,t)},l=function(){c.ajax({url:s[2]+"box/save",type:"POST",async:!1,data:{cardId:o.cardId,address:o.address,name:o.name,phone:o.phone,latitude:o.location.lat,longitude:o.location.lng,departmentId:o.community.id1},success:function(n){}})},d=function(){c.getJSON(s[0]+s[4].replace("$street","street"),function(n){u(n)})},p=function(n,t){for(var e=!1,o=-1,r=t.length,a=r-1;++o<r;a=o)(t[o].lat<=n.lat&&n.lat<t[a].lat||t[a].lat<=n.lat&&n.lat<t[o].lat)&&n.lng<(t[a].lng-t[o].lng)*(n.lat-t[o].lat)/(t[a].lat-t[o].lat)+t[o].lng&&(e=!e);return e};return a(),{getUserInfo:function(n){"function"==typeof n?e?n(o,t):r.push(n):console.error("\u53c2\u6570\u9519\u8bef")}}}function r(n,e){var o,r,a,i,u;if("object"==typeof n){o=n,r="number"!=typeof e||0>e||e>2?1:e,a=o.length,i=-1,u=null;var c=function(){var n=t.getElementsByTagName("body")[0];u=t.createElement("audio"),u.style.display="none",n.appendChild(u),f(),u.onended=function(){d()}},f=function(){-1==i?d():u.play()},s=function(){u.pause()},l=function(){},d=function(){var n=i;if(0==r)-1==n&&(n=0);else if(1==r)-1==n?n=0:n==a-1?n=0:n++;else if(2==r&&(n=parseInt(a*Math.random()),a>1&&n==i||n>a-1||0>n))return void d();p(n)},p=function(n){u.src=o[n],u.play(),i=n},m=function(n){o.push(n),a=o.length},y=function(n){o=n,a=o.length},v=function(n){"number"==typeof n&&n>=0&&3>n&&(r=n)};return c(),{play:f,next:d,pre:l,pause:s,playByIdx:p,addMusic:m,setMusic:y,setType:v}}}function a(){var n=function(n,t){var e=["before","center","after"],o=!0;if("function"==typeof n)o=n(t),void 0===o&&(o=!0);else if("object"==typeof n)for(var r in e)"function"==typeof n[e[r]]&&o&&(o=n[e[r]](t),void 0===o&&(o=!0));return o};return{index:{},size:{},keyListener:function(e){var o=e.id,r=c("#"+o),a=r;t.getElementById(o).onkeydown=function(t){var o=t.target;switch(t&&t.keyCode){case 8:return n(e.back,o);case 13:return n(e.enter,o);case 27:return n(e.esc,o);case 33:return n(e.pageUp,o);case 34:return n(e.pageDown,o);case 37:return n(e.left,o);case 38:return n(e.up,o);case 39:return n(e.right,o);case 40:return n(e.down,o);case 48:return n(e.n0,o);case 49:return n(e.n1,o);case 50:return n(e.n2,o);case 51:return n(e.n3,o);case 52:return n(e.n4,o);case 53:return n(e.n5,o);case 54:return n(e.n6,o);case 55:return n(e.n7,o);case 56:return n(e.n8,o);case 57:return n(e.n9,o)}},e.label&&(a=r.find(e.label)),a.focus(function(){"function"==typeof e.focus&&e.focus(this)}),a.blur(function(){"function"==typeof e.blur&&e.blur(this)}),a.click(function(){var n=!0;"function"==typeof e.click&&(n=e.click(this),void 0===n&&(n=!0)),"function"==typeof e.enter&&n&&(c(this).attr("tabindex","-1").focus(),e.enter(this))})},listKeyListener:function(n){var t=this,e=n.id,o=c("#"+e).find(n.label),r=o.length;if(this.index[e]=0,this.size[e]=r,"function"!=typeof n.left&&("object"!=typeof n.left?n.left=function(n){var t=c(n).index();c(o[--t]).attr("tabindex",-1).focus()}:"function"!=typeof n.left.center&&(n.left.center=function(n){var t=c(n).index();c(o[--t]).attr("tabindex",-1).focus()})),"function"!=typeof n.up&&("object"!=typeof n.up?n.up=function(t){var e=c(t).index();e>n.columnNum-1&&(e-=n.columnNum,c(o[e]).attr("tabindex",-1).focus())}:"function"!=typeof n.up.center&&(n.up.center=function(t){var e=c(t).index();e>n.columnNum-1&&(e-=n.columnNum,c(o[e]).attr("tabindex",-1).focus())})),"function"!=typeof n.right&&("object"!=typeof n.right?n.right=function(n){var t=c(n).index();r-1>t&&c(o[++t]).attr("tabindex",-1).focus()}:"function"!=typeof n.right.center&&(n.right.center=function(n){var t=c(n).index();r-1>t&&c(o[++t]).attr("tabindex",-1).focus()})),"function"!=typeof n.down&&("object"!=typeof n.down?n.down=function(t){var e=c(t).index();e<r-n.columnNum&&(e+=n.columnNum,c(o[e]).attr("tabindex",-1).focus())}:"function"!=typeof n.down.center&&(n.down.center=function(t){var e=c(t).index();e<r-n.columnNum&&(e+=n.columnNum,c(o[e]).attr("tabindex",-1).focus())})),"function"==typeof n.focus){var a=n.focus;n.focus=function(n){t.index[e]=c(n).index(),a(n)}}else n.focus=function(n){t.index[e]=c(n).index()};this.keyListener(n)}}}function i(t){var e,o="",r={},a=null,i=function(){var n=c("#GHSMLib").attr("key");n&&c.getJSON(s[0]+s[3].replace("$key",n),function(n){o=n.ws[0].url,e=n.ws[0].subscribe,""!=o?u():console.error("\u9519\u8bef\u7684ws")})},u=function(){var e=new SockJS(o+t);a=Stomp.over(e),a.debug=function(n){},a.connect({},function(){l()},p()),n.onbeforeunload=function(){f()}},f=function(){a.disconnect(),a=null},l=function(){for(var n in e)a.subscribe(e[n],function(n){var t=JSON.parse(n.body),e=t.action,o=t.props;r[e]&&"function"==typeof r[e]&&r[e](o,t.openId)})},p=function(){return function(){setTimeout(function(){u()},1e3)}};return i(),{addActions:function(n){return"object"==typeof n?(d.extend(r,n),!0):!1}}}function u(){c||(c=l?n.jQuery:jQuery.noConflict(!0));var t="1.0.1.201603251040",u="undefined"!=typeof CyberCloud?CyberCloud.GetParam("CardID").ParamValue?CyberCloud.GetParam("CardID").ParamValue:CyberCloud.GetParam("UserCode").ParamValue?CyberCloud.GetParam("UserCode").ParamValue.replace("CA",""):"":"",f=new i(u),s=new a,m=r,y=new o(u),v=function(n){y.getUserInfo(n)};new e(u);return{version:t,cardId:u,addActions:f.addActions,keyCon:s,AudioPlayer:m,getUserInfo:v,backYunPage:p,utils:d}}var c=n.GHSMLib.JQuery,f=n.GHSMLib.baseURL,s=n.GHSMLib.APIUrl,l=n.GHSMLib.getJQuery,d=function(){var e={};return e.getTime=Date.now||(new Date).getTime(),e.extend=function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])},e.loadScript=function(n,e){var o=t.getElementsByTagName("head")[0];if(o){var r=t.createElement("script");r.setAttribute("src",n),r.setAttribute("type","text/javascript"),r.onload=e,o.appendChild(r)}},e.qrCode=function(n,t){return s[1].replace("$text",n).replace("$size",t)},e.getQueryString=function(t){var e=RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=n.location.search.substr(1).match(e);return null!=o?o[2]:null},e.getHashString=function(t){var e=RegExp("(^|&|#)"+t+"=([^&]*)(&|$)","i"),o=n.location.hash.substr(1).match(e);return null!=o?o[2]:null},e}();e.prototype.pv=function(){var n=(new Date).getTime();c.getJSON("http://172.16.188.26/web/userBehavior/pv.json?appName="+this.appName+"&cardId="+this.cardId+"&timestamp="+n)};var p=function(t){var e=sessionStorage.getItem("flytvYunFrom");e?n.location.href=e:n.location.href=t};n.GHSMLib=new u,"function"==typeof GHSMLibOnLoad&&GHSMLibOnLoad()}(window,document);