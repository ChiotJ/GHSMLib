/**
 * Created by jian_ on 2016/2/18.
 */
!function(t,n){"use strict";function e(n){var e,i=t.location.hostname,o=t.location.pathname;a.ajax({url:s+"/json/userBehavior/pvSetting.json",async:!1,success:function(t){var n=t[i];if(n&&n.length>0)for(var r in n){var u=n[r].regular,c=n[r].name;for(var a in u)0==o.indexOf(u[a])&&(e=c)}}}),e&&n&&(this.appName=e,this.cardId=n,this.pv())}function i(t){var n,e,i=!1,o={cardId:t},r=[],u=function(){a.ajax({url:f[2]+"box/getBoxByCardId",data:{cardId:o.cardId},type:"GET",dataType:"json",success:function(t){t.success?(o.name=t.result.name,o.phone=t.result.phone,o.address=t.result.address,o.location={},o.location.lat=t.result.latitude,o.location.lng=t.result.longitude,"object"==typeof t.result.department&&(o.departmentId=t.result.department.id),l()):(e="\u670d\u52a1\u5668\u9519\u8bef",s())},error:function(t){e="\u670d\u52a1\u5668\u9519\u8bef",s()}})},c=function(){var t={lat:o.location.lat,lng:o.location.lng},e=n.communitys;for(var i in e){var r=e[i],u=r.poly,c=p(t,u);if(c){var a=o.departmentId;o.departmentId=r.id1,o.street=n.id,o.community={},o.community.name=r.name,o.community.id1=r.id1,o.community.id2=r.id2,(void 0===a||a!=o.departmentId)&&d();break}}void 0===o.community&&(o.community="\u6b64\u5730\u5740\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u793e\u533a"),s()},s=function(){if(i=!0,r.length>0)for(var t in r)r[t](o,e)},d=function(){a.ajax({url:f[2]+"box/save",type:"POST",async:!1,data:{cardId:o.cardId,address:o.address,name:o.name,phone:o.phone,latitude:o.location.lat,longitude:o.location.lng,departmentId:o.community.id1},success:function(t){}})},l=function(){a.getJSON(f[0]+f[4].replace("$street","11e6801f-9a5d-4a6b-be6c-e6bc7820cc57"),function(t){n=t,c()})},p=function(t,n){for(var e=!1,i=-1,o=n.length,r=o-1;++i<o;r=i)(n[i].lat<=t.lat&&t.lat<n[r].lat||n[r].lat<=t.lat&&t.lat<n[i].lat)&&t.lng<(n[r].lng-n[i].lng)*(t.lat-n[i].lat)/(n[r].lat-n[i].lat)+n[i].lng&&(e=!e);return e};return u(),{getUserInfo:function(t){"function"==typeof t?i?t(o,e):r.push(t):console.error("\u53c2\u6570\u9519\u8bef")}}}function o(t,e){var i,o,r,u,c;if("object"==typeof t){i=t,o="number"!=typeof e||0>e||e>2?1:e,r=i.length,u=-1,c=null;var a=function(){var t=n.getElementsByTagName("body")[0];c=n.createElement("audio"),c.style.display="none",t.appendChild(c),s(),c.onended=function(){l()}},s=function(){-1==u?l():c.play()},f=function(){c.pause()},d=function(){},l=function(){var t=u;if(0==o)-1==t&&(t=0);else if(1==o)-1==t?t=0:t==r-1?t=0:t++;else if(2==o&&(t=parseInt(r*Math.random()),r>1&&t==u||t>r-1||0>t))return void l();p(t)},p=function(t){c.src=i[t],c.play(),u=t},h=function(t){i.push(t),r=i.length},m=function(t){i=t,r=i.length},y=function(t){"number"==typeof t&&t>=0&&3>t&&(o=t)};return a(),{next:l,pre:d,pause:f,playByIdx:p,addMusic:h,setMusic:m,setType:y}}}function r(){var t={},e={},i=function(t,n){var e=["before","center","after"],i=!0;if("function"==typeof t)i=t(n),void 0===i&&(i=!0);else if("object"==typeof t)for(var o in e)"function"==typeof t[e[o]]&&i&&(i=t[e[o]](n),void 0===i&&(i=!0));return i};return{keyListener:function(t){var e=t.id,o=a("#"+e),r=o;n.getElementById(e).onkeydown=function(n){var e=n.target;switch(n&&n.keyCode){case 8:return i(t.back,e);case 13:return i(t.enter,e);case 27:return i(t.esc,e);case 33:return i(t.pageUp,e);case 34:return i(t.pageDown,e);case 37:return i(t.left,e);case 38:return i(t.up,e);case 39:return i(t.right,e);case 40:return i(t.down,e);case 48:return i(t.n0,e);case 49:return i(t.n1,e);case 50:return i(t.n2,e);case 51:return i(t.n3,e);case 52:return i(t.n4,e);case 53:return i(t.n5,e);case 54:return i(t.n6,e);case 55:return i(t.n7,e);case 56:return i(t.n8,e);case 57:return i(t.n9,e)}},t.label&&(r=o.find(t.label)),r.focus(function(){"function"==typeof t.focus&&t.focus(this)}),r.blur(function(){"function"==typeof t.blur&&t.blur(this)}),r.click(function(){var n=!0;"function"==typeof t.click&&(n=t.click(this),void 0===n&&(n=!0)),"function"==typeof t.enter&&n&&(a(this).attr("tabindex","-1").focus(),t.enter(this))})},listKeyListener:function(n){var i=n.id,o=a("#"+i).find(n.label),r=o.length;if(t[i]=0,e[i]=r,"function"!=typeof n.left&&("object"!=typeof n.left?n.left=function(t){var n=a(t).index();a(o[--n]).attr("tabindex",-1).focus()}:"function"!=typeof n.left.center&&(n.left.center=function(t){var n=a(t).index();a(o[--n]).attr("tabindex",-1).focus()})),"function"!=typeof n.up&&("object"!=typeof n.up?n.up=function(t){var e=a(t).index();e>n.columnNum-1&&(e-=n.columnNum,a(o[e]).attr("tabindex",-1).focus())}:"function"!=typeof n.up.center&&(n.up.center=function(t){var e=a(t).index();e>n.columnNum-1&&(e-=n.columnNum,a(o[e]).attr("tabindex",-1).focus())})),"function"!=typeof n.right&&("object"!=typeof n.right?n.right=function(t){var n=a(t).index();r-1>n&&a(o[++n]).attr("tabindex",-1).focus()}:"function"!=typeof n.right.center&&(n.right.center=function(t){var n=a(t).index();r-1>n&&a(o[++n]).attr("tabindex",-1).focus()})),"function"!=typeof n.down&&("object"!=typeof n.down?n.down=function(t){var e=a(t).index();e<r-n.columnNum&&(e+=n.columnNum,a(o[e]).attr("tabindex",-1).focus())}:"function"!=typeof n.down.center&&(n.down.center=function(t){var e=a(t).index();e<r-n.columnNum&&(e+=n.columnNum,a(o[e]).attr("tabindex",-1).focus())})),"function"==typeof n.focus){var u=n.focus;n.focus=function(n){t[i]=a(n).index(),u(n)}}else n.focus=function(n){t[i]=a(n).index()};this.keyListener(n)}}}function u(n){var e,i="",o={},r=null,u=function(){var t=a("#GHSMLib").attr("key");t&&a.getJSON(f[0]+f[3].replace("$key",t),function(t){i=t.ws[0].url,e=t.ws[0].subscribe,""!=i?c():console.error("\u9519\u8bef\u7684ws")})},c=function(){var e=new SockJS(i+n);r=Stomp.over(e),r.debug=function(t){},r.connect({},function(){l()},p()),t.onbeforeunload=function(){s()}},s=function(){r.disconnect(),r=null},l=function(){for(var t in e)r.subscribe(e[t],function(t){var n=JSON.parse(t.body),e=n.action,i=n.props;o[e]&&"function"==typeof o[e]&&o[e](i,n.openId)})},p=function(){return function(){setTimeout(function(){c()},1e3)}};return u(),{addActions:function(t){return"object"==typeof t?(d.extend(o,t),!0):!1}}}function c(){a||(a=jQuery.noConflict(!0));var t="1.0.1.201603021740",n="undefined"!=typeof CyberCloud?CyberCloud.GetParam("CardID").ParamValue?CyberCloud.GetParam("CardID").ParamValue:CyberCloud.GetParam("UserCode").ParamValue?CyberCloud.GetParam("UserCode").ParamValue.replace("CA",""):"":"",c=new u(n),s=new r,f=o,l=new i(n),p=function(t){l.getUserInfo(t)};new e(n);return{version:t,cardId:n,addActions:c.addActions,keyCon:s,AudioPlayer:f,getUserInfo:p,utils:d}}var a=t.GHSMLib.JQuery,s=t.GHSMLib.baseURL,f=t.GHSMLib.APIUrl,d=function(){var e={};return e.getTime=Date.now||(new Date).getTime(),e.extend=function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])},e.loadScript=function(t,e){var i=n.getElementsByTagName("head")[0];if(i){var o=n.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.onload=e,i.appendChild(o)}},e.qrCode=function(t,n){return f[1].replace("$text",t).replace("$size",n)},e.getQueryString=function(n){var e=RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),i=t.location.search.substr(1).match(e);return null!=i?i[2]:null},e.getHashString=function(n){var e=RegExp("(^|&|#)"+n+"=([^&]*)(&|$)","i"),i=t.location.hash.substr(1).match(e);return null!=i?i[2]:null},e}();e.prototype.pv=function(){var t=(new Date).getTime();a.getJSON("http://172.16.188.26/web/userBehavior/pv.json?appName="+this.appName+"&cardId="+this.cardId+"&timestamp="+t)},t.GHSMLib=new c}(window,document);