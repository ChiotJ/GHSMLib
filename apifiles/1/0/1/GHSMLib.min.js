/**
 * Created by jian_ on 2016/2/18.
 */
!function(n,e){"use strict";function t(e){var t,o=n.location.hostname,r=n.location.pathname;c.ajax({url:f+"/json/userBehavior/pvSetting.json",async:!1,success:function(n){var e=n[o];if(e&&e.length>0)for(var a in e){var i=e[a].regular,u=e[a].name;for(var c in i)0==r.indexOf(i[c])&&(t=u)}}}),t&&e&&(this.appName=t,this.cardId=e,this.pv())}function o(n){var e,t,o=!1,r={cardId:n},a=[],i=function(){c.ajax({url:s[2]+"box/getBoxByCardId",data:{cardId:r.cardId},type:"GET",dataType:"json",success:function(n){n.success?(r.name=n.result.name,r.phone=n.result.phone,r.address=n.result.address,r.location={},r.location.lat=n.result.latitude,r.location.lng=n.result.longitude,"object"==typeof n.result.department&&(r.departmentId=n.result.department.id),l()):(t="\u670d\u52a1\u5668\u9519\u8bef",f())},error:function(n){t="\u670d\u52a1\u5668\u9519\u8bef",f()}})},u=function(){var n={lat:r.location.lat,lng:r.location.lng},t=e.communitys;for(var o in t){var a=t[o],i=a.poly,u=p(n,i);if(u){var c=r.departmentId;r.departmentId=a.id1,r.street=e.id,r.community={},r.community.name=a.name,r.community.id1=a.id1,r.community.id2=a.id2,(void 0===c||c!=r.departmentId)&&d();break}}void 0===r.community&&(r.community="\u6b64\u5730\u5740\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u793e\u533a"),f()},f=function(){if(o=!0,a.length>0)for(var n in a)a[n](r,t)},d=function(){c.ajax({url:s[2]+"box/save",type:"POST",async:!1,data:{cardId:r.cardId,address:r.address,name:r.name,phone:r.phone,latitude:r.location.lat,longitude:r.location.lng,departmentId:r.community.id1},success:function(n){}})},l=function(){c.getJSON(s[0]+s[4].replace("$street","11e6801f-9a5d-4a6b-be6c-e6bc7820cc57"),function(n){e=n,u()})},p=function(n,e){for(var t=!1,o=-1,r=e.length,a=r-1;++o<r;a=o)(e[o].lat<=n.lat&&n.lat<e[a].lat||e[a].lat<=n.lat&&n.lat<e[o].lat)&&n.lng<(e[a].lng-e[o].lng)*(n.lat-e[o].lat)/(e[a].lat-e[o].lat)+e[o].lng&&(t=!t);return t};return i(),{getUserInfo:function(n){"function"==typeof n?o?n(r,t):a.push(n):console.error("\u53c2\u6570\u9519\u8bef")}}}function r(n,t){var o,r,a,i,u;if("object"==typeof n){o=n,r="number"!=typeof t||0>t||t>2?1:t,a=o.length,i=-1,u=null;var c=function(){var n=e.getElementsByTagName("body")[0];u=e.createElement("audio"),u.style.display="none",n.appendChild(u),f(),u.onended=function(){l()}},f=function(){-1==i?l():u.play()},s=function(){u.pause()},d=function(){},l=function(){var n=i;if(0==r)-1==n&&(n=0);else if(1==r)-1==n?n=0:n==a-1?n=0:n++;else if(2==r&&(n=parseInt(a*Math.random()),a>1&&n==i||n>a-1||0>n))return void l();p(n)},p=function(n){u.src=o[n],u.play(),i=n},m=function(n){o.push(n),a=o.length},y=function(n){o=n,a=o.length},v=function(n){"number"==typeof n&&n>=0&&3>n&&(r=n)};return c(),{play:f,next:l,pre:d,pause:s,playByIdx:p,addMusic:m,setMusic:y,setType:v}}}function a(){var n=function(n,e){var t=["before","center","after"],o=!0;if("function"==typeof n)o=n(e),void 0===o&&(o=!0);else if("object"==typeof n)for(var r in t)"function"==typeof n[t[r]]&&o&&(o=n[t[r]](e),void 0===o&&(o=!0));return o};return{index:{},size:{},keyListener:function(t){var o=t.id,r=c("#"+o),a=r;e.getElementById(o).onkeydown=function(e){var o=e.target;switch(e&&e.keyCode){case 8:return n(t.back,o);case 13:return n(t.enter,o);case 27:return n(t.esc,o);case 33:return n(t.pageUp,o);case 34:return n(t.pageDown,o);case 37:return n(t.left,o);case 38:return n(t.up,o);case 39:return n(t.right,o);case 40:return n(t.down,o);case 48:return n(t.n0,o);case 49:return n(t.n1,o);case 50:return n(t.n2,o);case 51:return n(t.n3,o);case 52:return n(t.n4,o);case 53:return n(t.n5,o);case 54:return n(t.n6,o);case 55:return n(t.n7,o);case 56:return n(t.n8,o);case 57:return n(t.n9,o)}},t.label&&(a=r.find(t.label)),a.focus(function(){"function"==typeof t.focus&&t.focus(this)}),a.blur(function(){"function"==typeof t.blur&&t.blur(this)}),a.click(function(){var n=!0;"function"==typeof t.click&&(n=t.click(this),void 0===n&&(n=!0)),"function"==typeof t.enter&&n&&(c(this).attr("tabindex","-1").focus(),t.enter(this))})},listKeyListener:function(n){var e=this,t=n.id,o=c("#"+t).find(n.label),r=o.length;if(this.index[t]=0,this.size[t]=r,"function"!=typeof n.left&&("object"!=typeof n.left?n.left=function(n){var e=c(n).index();c(o[--e]).attr("tabindex",-1).focus()}:"function"!=typeof n.left.center&&(n.left.center=function(n){var e=c(n).index();c(o[--e]).attr("tabindex",-1).focus()})),"function"!=typeof n.up&&("object"!=typeof n.up?n.up=function(e){var t=c(e).index();t>n.columnNum-1&&(t-=n.columnNum,c(o[t]).attr("tabindex",-1).focus())}:"function"!=typeof n.up.center&&(n.up.center=function(e){var t=c(e).index();t>n.columnNum-1&&(t-=n.columnNum,c(o[t]).attr("tabindex",-1).focus())})),"function"!=typeof n.right&&("object"!=typeof n.right?n.right=function(n){var e=c(n).index();r-1>e&&c(o[++e]).attr("tabindex",-1).focus()}:"function"!=typeof n.right.center&&(n.right.center=function(n){var e=c(n).index();r-1>e&&c(o[++e]).attr("tabindex",-1).focus()})),"function"!=typeof n.down&&("object"!=typeof n.down?n.down=function(e){var t=c(e).index();t<r-n.columnNum&&(t+=n.columnNum,c(o[t]).attr("tabindex",-1).focus())}:"function"!=typeof n.down.center&&(n.down.center=function(e){var t=c(e).index();t<r-n.columnNum&&(t+=n.columnNum,c(o[t]).attr("tabindex",-1).focus())})),"function"==typeof n.focus){var a=n.focus;n.focus=function(n){e.index[t]=c(n).index(),a(n)}}else n.focus=function(n){e.index[t]=c(n).index()};this.keyListener(n)}}}function i(e){var t,o="",r={},a=null,i=function(){var n=c("#GHSMLib").attr("key");n&&c.getJSON(s[0]+s[3].replace("$key",n),function(n){o=n.ws[0].url,t=n.ws[0].subscribe,""!=o?u():console.error("\u9519\u8bef\u7684ws")})},u=function(){var t=new SockJS(o+e);a=Stomp.over(t),a.debug=function(n){},a.connect({},function(){d()},p()),n.onbeforeunload=function(){f()}},f=function(){a.disconnect(),a=null},d=function(){for(var n in t)a.subscribe(t[n],function(n){var e=JSON.parse(n.body),t=e.action,o=e.props;r[t]&&"function"==typeof r[t]&&r[t](o,e.openId)})},p=function(){return function(){setTimeout(function(){u()},1e3)}};return i(),{addActions:function(n){return"object"==typeof n?(l.extend(r,n),!0):!1}}}function u(){c||(c=d?n.jQuery:jQuery.noConflict(!0));var e="1.0.1.201603251040",u="undefined"!=typeof CyberCloud?CyberCloud.GetParam("CardID").ParamValue?CyberCloud.GetParam("CardID").ParamValue:CyberCloud.GetParam("UserCode").ParamValue?CyberCloud.GetParam("UserCode").ParamValue.replace("CA",""):"":"",f=new i(u),s=new a,m=r,y=new o(u),v=function(n){y.getUserInfo(n)};new t(u);return{version:e,cardId:u,addActions:f.addActions,keyCon:s,AudioPlayer:m,getUserInfo:v,backYunPage:p,utils:l}}var c=n.GHSMLib.JQuery,f=n.GHSMLib.baseURL,s=n.GHSMLib.APIUrl,d=n.GHSMLib.getJQuery,l=function(){var t={};return t.getTime=Date.now||(new Date).getTime(),t.extend=function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},t.loadScript=function(n,t){var o=e.getElementsByTagName("head")[0];if(o){var r=e.createElement("script");r.setAttribute("src",n),r.setAttribute("type","text/javascript"),r.onload=t,o.appendChild(r)}},t.qrCode=function(n,e){return s[1].replace("$text",n).replace("$size",e)},t.getQueryString=function(e){var t=RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=n.location.search.substr(1).match(t);return null!=o?o[2]:null},t.getHashString=function(e){var t=RegExp("(^|&|#)"+e+"=([^&]*)(&|$)","i"),o=n.location.hash.substr(1).match(t);return null!=o?o[2]:null},t}();t.prototype.pv=function(){var n=(new Date).getTime();c.getJSON("http://172.16.188.26/web/userBehavior/pv.json?appName="+this.appName+"&cardId="+this.cardId+"&timestamp="+n)};var p=function(e){var t=sessionStorage.getItem("flytvYunFrom");t?n.location.href=t:n.location.href=e};n.GHSMLib=new u,"function"==typeof GHSMLibOnLoad&&GHSMLibOnLoad()}(window,document);