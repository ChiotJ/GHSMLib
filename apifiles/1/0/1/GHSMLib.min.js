/**
 * Created by jian_ on 2016/2/18.
 */
!function(n,t){"use strict";function e(t){var e,o=n.location.hostname,r=n.location.pathname;c.ajax({url:f+"/json/userBehavior/pvSetting.json",async:!1,success:function(n){var t=n[o];if(t&&t.length>0)for(var a in t){var i=t[a].regular,u=t[a].name;for(var c in i)0==r.indexOf(i[c])&&(e=u)}}}),e&&t&&(this.appName=e,this.cardId=t,this.pv())}function o(n){var t,e,o=!1,r={cardId:n},a=[],i=function(){c.ajax({url:s[2]+"box/getBoxByCardId",data:{cardId:r.cardId},type:"GET",dataType:"json",success:function(n){n.success?(r.name=n.result.name,r.phone=n.result.phone,r.address=n.result.address,r.location={},r.location.lat=n.result.latitude,r.location.lng=n.result.longitude,"object"==typeof n.result.department&&(r.departmentId=n.result.department.id),l()):(e="\u670d\u52a1\u5668\u9519\u8bef",f())},error:function(n){e="\u670d\u52a1\u5668\u9519\u8bef",f()}})},u=function(){var n={lat:r.location.lat,lng:r.location.lng},e=t.communitys;for(var o in e){var a=e[o],i=a.poly,u=p(n,i);if(u){var c=r.departmentId;r.departmentId=a.id1,r.street=t.id,r.community={},r.community.name=a.name,r.community.id1=a.id1,r.community.id2=a.id2,(void 0===c||c!=r.departmentId)&&d();break}}void 0===r.community&&(r.community="\u6b64\u5730\u5740\u4e0d\u5c5e\u4e8e\u4efb\u4f55\u793e\u533a"),f()},f=function(){if(o=!0,a.length>0)for(var n in a)a[n](r,e)},d=function(){c.ajax({url:s[2]+"box/save",type:"POST",async:!1,data:{cardId:r.cardId,address:r.address,name:r.name,phone:r.phone,latitude:r.location.lat,longitude:r.location.lng,departmentId:r.community.id1},success:function(n){}})},l=function(){c.getJSON(s[0]+s[4].replace("$street","11e6801f-9a5d-4a6b-be6c-e6bc7820cc57"),function(n){t=n,u()})},p=function(n,t){for(var e=!1,o=-1,r=t.length,a=r-1;++o<r;a=o)(t[o].lat<=n.lat&&n.lat<t[a].lat||t[a].lat<=n.lat&&n.lat<t[o].lat)&&n.lng<(t[a].lng-t[o].lng)*(n.lat-t[o].lat)/(t[a].lat-t[o].lat)+t[o].lng&&(e=!e);return e};return i(),{getUserInfo:function(n){"function"==typeof n?o?n(r,e):a.push(n):console.error("\u53c2\u6570\u9519\u8bef")}}}function r(n,e){var o,r,a,i,u;if("object"==typeof n){o=n,r="number"!=typeof e||0>e||e>2?1:e,a=o.length,i=-1,u=null;var c=function(){var n=t.getElementsByTagName("body")[0];u=t.createElement("audio"),u.style.display="none",n.appendChild(u),f(),u.onended=function(){l()}},f=function(){-1==i?l():u.play()},s=function(){u.pause()},d=function(){},l=function(){var n=i;if(0==r)-1==n&&(n=0);else if(1==r)-1==n?n=0:n==a-1?n=0:n++;else if(2==r&&(n=parseInt(a*Math.random()),a>1&&n==i||n>a-1||0>n))return void l();p(n)},p=function(n){u.src=o[n],u.play(),i=n},m=function(n){o.push(n),a=o.length},y=function(n){o=n,a=o.length},v=function(n){"number"==typeof n&&n>=0&&3>n&&(r=n)};return c(),{next:l,pre:d,pause:s,playByIdx:p,addMusic:m,setMusic:y,setType:v}}}function a(){var n={},e={},o=function(n,t){var e=["before","center","after"],o=!0;if("function"==typeof n)o=n(t),void 0===o&&(o=!0);else if("object"==typeof n)for(var r in e)"function"==typeof n[e[r]]&&o&&(o=n[e[r]](t),void 0===o&&(o=!0));return o};return{keyListener:function(n){var e=n.id,r=c("#"+e),a=r;t.getElementById(e).onkeydown=function(t){var e=t.target;switch(t&&t.keyCode){case 8:return o(n.back,e);case 13:return o(n.enter,e);case 27:return o(n.esc,e);case 33:return o(n.pageUp,e);case 34:return o(n.pageDown,e);case 37:return o(n.left,e);case 38:return o(n.up,e);case 39:return o(n.right,e);case 40:return o(n.down,e);case 48:return o(n.n0,e);case 49:return o(n.n1,e);case 50:return o(n.n2,e);case 51:return o(n.n3,e);case 52:return o(n.n4,e);case 53:return o(n.n5,e);case 54:return o(n.n6,e);case 55:return o(n.n7,e);case 56:return o(n.n8,e);case 57:return o(n.n9,e)}},n.label&&(a=r.find(n.label)),a.focus(function(){"function"==typeof n.focus&&n.focus(this)}),a.blur(function(){"function"==typeof n.blur&&n.blur(this)}),a.click(function(){var t=!0;"function"==typeof n.click&&(t=n.click(this),void 0===t&&(t=!0)),"function"==typeof n.enter&&t&&(c(this).attr("tabindex","-1").focus(),n.enter(this))})},listKeyListener:function(t){var o=t.id,r=c("#"+o).find(t.label),a=r.length;if(n[o]=0,e[o]=a,"function"!=typeof t.left&&("object"!=typeof t.left?t.left=function(n){var t=c(n).index();c(r[--t]).attr("tabindex",-1).focus()}:"function"!=typeof t.left.center&&(t.left.center=function(n){var t=c(n).index();c(r[--t]).attr("tabindex",-1).focus()})),"function"!=typeof t.up&&("object"!=typeof t.up?t.up=function(n){var e=c(n).index();e>t.columnNum-1&&(e-=t.columnNum,c(r[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.up.center&&(t.up.center=function(n){var e=c(n).index();e>t.columnNum-1&&(e-=t.columnNum,c(r[e]).attr("tabindex",-1).focus())})),"function"!=typeof t.right&&("object"!=typeof t.right?t.right=function(n){var t=c(n).index();a-1>t&&c(r[++t]).attr("tabindex",-1).focus()}:"function"!=typeof t.right.center&&(t.right.center=function(n){var t=c(n).index();a-1>t&&c(r[++t]).attr("tabindex",-1).focus()})),"function"!=typeof t.down&&("object"!=typeof t.down?t.down=function(n){var e=c(n).index();e<a-t.columnNum&&(e+=t.columnNum,c(r[e]).attr("tabindex",-1).focus())}:"function"!=typeof t.down.center&&(t.down.center=function(n){var e=c(n).index();e<a-t.columnNum&&(e+=t.columnNum,c(r[e]).attr("tabindex",-1).focus())})),"function"==typeof t.focus){var i=t.focus;t.focus=function(t){n[o]=c(t).index(),i(t)}}else t.focus=function(t){n[o]=c(t).index()};this.keyListener(t)}}}function i(t){var e="",o="",r={},a=null,i=function(){var n=c("#GHSMLib").attr("key");n&&c.getJSON(s[0]+s[3].replace("$key",n),function(n){e=n.ws,o=n.subscribe,""!=e?u():console.error("\u9519\u8bef\u7684ws")})},u=function(){var o=new SockJS(e+t);a=Stomp.over(o),a.debug=function(n){},a.connect({},function(){l()},p()),n.onbeforeunload=function(){f()}},f=function(){a.disconnect(),a=null},l=function(){a.subscribe(o,function(n){var t=JSON.parse(n.body),e=t.action,o=t.props;r[e]&&"function"==typeof r[e]&&r[e](o,t.openId)})},p=function(){return function(){setTimeout(function(){u()},1e3)}};return i(),{addActions:function(n){return"object"==typeof n?(d.extend(r,n),!0):!1}}}function u(){c||(c=jQuery.noConflict(!0));var n="1.0.1.201602041104",t="undefined"!=typeof CyberCloud?CyberCloud.GetParam("CardID").ParamValue?CyberCloud.GetParam("CardID").ParamValue:CyberCloud.GetParam("UserCode").ParamValue?CyberCloud.GetParam("UserCode").ParamValue.replace("CA",""):"":"",u=new i(t),f=new a,s=r,l=new o(t),p=function(n){l.getUserInfo(n)};new e(t);return{version:n,cardId:t,addActions:u.addActions,keyCon:f,AudioPlayer:s,getUserInfo:p,utils:d}}var c=n.GHSMLib.JQuery,f=n.GHSMLib.baseURL,s=n.GHSMLib.APIUrl,d=function(){var e={};return e.getTime=Date.now||(new Date).getTime(),e.extend=function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])},e.loadScript=function(n,e){var o=t.getElementsByTagName("head")[0];if(o){var r=t.createElement("script");r.setAttribute("src",n),r.setAttribute("type","text/javascript"),r.onload=e,o.appendChild(r)}},e.qrCode=function(n,t){return s[1].replace("$text",n).replace("$size",t)},e.getQueryString=function(t){var e=RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),o=n.location.search.substr(1).match(e);return null!=o?o[2]:null},e.getHashString=function(t){var e=RegExp("(^|&|#)"+t+"=([^&]*)(&|$)","i"),o=n.location.hash.substr(1).match(e);return null!=o?o[2]:null},e}();e.prototype.pv=function(){var n=(new Date).getTime();c.getJSON("http://172.16.188.26/web/userBehavior/pv.json?appName="+this.appName+"&cardId="+this.cardId+"&timestamp="+n)},n.GHSMLib=new u}(window,document);